{
    "$schema" : "https://json-schema.org/draft/2020-12/schema",
    "$id" : "https://cybersecuritypoet.github.io/koala-json-schema/conntrackd_config.schema.json",
    "title" : "Conntrackd config",
    "description" : "",
    "type" : "object",
    "additionalProperties" : false,
    "allOf":
    [
        {
            "required" : ["SYNC"]
        }
    ],
    "properties":
    {
        "skip":
        {
            "type" : ["boolean","null"],
            "description" : "Skip object."
        },
        "Systemd":
        {
            "type" : "boolean",
            "description" : "Enable systemd(1) runtime support if conntrackd(8) is compiled with the proper configuration."
        },
        "HashSize":
        {
            "type" : "integer",
            "description" : "Number of buckets in the cache hashtable. The bigger it is, the closer it gets to O(1) at the cost of consuming more memory."
        },
        "HashLimit":
        {
            "type" : "integer",
            "description" : "Maximum number of conntracks, it should be double of /proc/sys/net/netfilter/nf_conntrack_max since the daemon may keep some dead entries cached for possible retransmission during state synchronization."
        },
        "LogFile":
        {
            "type" : ["string", "null"],
            "description" : "Enable conntrackd(8) to log to a file."
        },
        "Syslog":
        {
            "type" : ["string", "null"],
            "description" : "Enable connection logging via Syslog.If you set the facility, use the same as in the Stats section, otherwise you'll get a warning message.",
            "enum" : ["kern","user","mail","daemon","auth","syslog","klpr","news","uucp","cron","authpriv","ftp","ntp","security","console","solaris-cron","local0","local1","local2","local3","local3","local4","local5","local6","local7"]
        },
        "Lockfile":
        {
            "type" : ["string", "null"],
            "description" : "Lockfile to be used by conntrackd(8) (absolute path)."
        },
        "NetlinkBufferSize":
        {
            "type" : "integer",
            "description" : "Netlink event socket buffer size. If you do not specify this clause, the default buffer size value in /proc/sys/net/core/rmem_default is used."
        },
        "NetlinkBufferSizeMaxGrowth":
        {
            "type" : "integer",
            "description" : "The daemon doubles the size of the netlink event socket buffer size if it detects netlink event message dropping."
        },
        "NetlinkOverrunResync":
        {
            "type" : ["integer", "null"],
            "description" : "If the daemon detects that Netlink is dropping state-change events, it automatically schedules a resynchronization against the Kernel after 30 seconds(default value). in seconds. (default 30)"
        },
        "NetlinkEventsReliable":
        {
            "type" : "boolean",
            "description" : "If you want reliable event reporting over Netlink, set on this option. If you set on this clause, it is a good idea to set off NetlinkOverrunResync."
        },
        "PollSecs":
        {
            "type" : "integer",
            "description" : "By default, the daemon receives state updates following an event-driven model. You can modify this behaviour by switching to polling mode with this clause."
        },
        "EventIterationLimit":
        {
            "type" : "integer",
            "description" : "With this clause, you can set the maximum number of state-change events (those coming from kernel-space) that the daemon will handle after which it will handle other events coming from the network or userspace."
        },
        "SYNC":
        {
            "type" : "object",
            "additionalProperties" : false,
            "description" : "SYNC configuration.",
            "properties":
            {
                "Mode":
                {
                    "type" : "string",
                    "description" : "Synchronization mode, accepts: notrack, alarm, ftfw",
                    "enum" : ["notrack","alarm","ftfw"]
                },
                "TCPWindowTracking":
                {
                    "type" : "boolean",
                    "description" : "TCP state-entries have window tracking disabled by default, you can enable it with this option. As said, default is off. This feature requires a Linux kernel >= 2.6.36."
                },
                "ExpectationSync":
                {
                    "type" : ["null","array"],
                    "description" : "Set this option on if you want to enable the synchronization of expectations. You have to specify the list of helpers that you want to enable. Default: disabled",
                    "items":
                    {
                        "type" : "string"
                    }
                },
                "FTFW" :
                {
                    "type" : "object",
                    "additionalProperties" : false,
                    "description" : "This mode is based on a reliable protocol that performs message tracking.Thus, the protocol can recover from message loss, re-ordering and corruption.",
                    "properties" :
                    {
                        "ResendQueueSize" :
                        {
                            "type" : "integer",
                            "description" : "Size of the resend queue (in objects). This is the maximum number of objects that can be stored waiting to be confirmed via acknoledgment."
                        },
                        "CommitTimeout" :
                        {
                            "type" : "integer",
                            "description" : "This parameter allows you to set an initial fixed timeout for the committed entries when this node goes from backup to primary."
                        },
                        "PurgeTimeout" :
                        {
                            "type" : "integer",
                            "description" : "If the firewall replica goes from primary to backup, the `conntrackd -t command' is invoked in the script. This command schedules a flush of the table in N seconds."
                        },
                        "ACKWindowSize" :
                        {
                            "type" : "integer",
                            "description" : "Set the acknowledgement window size. If you decrease this value, the number of acknowlegdments increases."
                        },
                        "DisableExternalCache" :
                        {
                            "type" : "boolean",
                            "description" : "This clause allows you to disable the external cache. Thus, the state entries are directly injected into the kernel conntrack table."
                        },
                        "StartupResync" :
                        {
                            "type" : "boolean",
                            "description" : "Order conntrackd to request a complete conntrack table resync against the other node at startup. A single request will be made."
                        }
                    }
                },
                "Alarm" :
                {
                    "type" : "object",
                    "additionalProperties" : false,
                    "description" : "This mode is spamming.It is based on a alarm-based protocol that periodically re-sends the flow state to the backup firewall replicas.",
                    "properties" :
                    {
                        "RefreshTime" :
                        {
                            "type" : "integer",
                            "description" : "If a conntrack entry is not modified in <= N seconds, then a message is broadcasted.For example, this mechanism may be used to resynchronize nodes that just joined the multicast group."
                        },
                        "CacheTimeout" :
                        {
                            "type" : "integer",
                            "description" : "If we don't receive a notification about the state of an entry in the external cache after N seconds, then remove it."
                        },
                        "CommitTimeout" :
                        {
                            "type" : "integer",
                            "description" : "This parameter allows you to set an initial fixed timeout for the committed entries when this node goes from backup to primary."
                        },
                        "PurgeTimeout" :
                        {
                            "type" : "integer",
                            "description" : "If the firewall replica goes from primary to backup, the `conntrackd -t command' is invoked in the script. This command schedules a flush of the table in N seconds."
                        }
                    }
                },
                "Notrack" :
                {
                    "type" : "object",
                    "additionalProperties" : false,
                    "description" : "Is the most simple mode as it is based on a best effort replication protocol, ie.unreliable protocol.",
                    "properties" :
                    {
                        "DisableInternalCache" :
                        {
                            "type" : "boolean",
                            "description" : "This clause allows you to disable the internal cache.Thus, the synchronization messages are directly sent through the dedicated link."
                        },
                        "DisableExternalCache" :
                        {
                            "type" : "boolean",
                            "description" : "This clause allows you to disable the external cache. Thus, the state entries are directly injected into the kernel conntrack table."
                        },
                        "CommitTimeout" :
                        {
                            "type" : "integer",
                            "description" : "This parameter allows you to set an initial fixed timeout for the committed entries when this node goes from backup to primary."
                        },
                        "PurgeTimeout" :
                        {
                            "type" : "integer",
                            "description" : "If the firewall replica goes from primary to backup, the `conntrackd -t command' is invoked in the script. This command schedules a flush of the table in N seconds."
                        },
                        "StartupResync" :
                        {
                            "type" : "boolean",
                            "description" : "Order conntrackd to request a complete conntrack table resync against the other node at startup. A single request will be made."
                        }
                    }
                },
                "Multicast" :
                {
                    "type" : "array",
                    "description" : "This section indicates to conntrackd(8) to use multicast as transport mechanism between nodes of the firewall cluster.",
                    "items" :
                    {
                        "type" : "object",
                        "additionalProperties" : false,
                        "required" : ["Group"],
                        "properties" :
                        {
                            "IPv4_address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "Multicast address: The address that you use as destination in the synchronization messages."
                            },
                            "Group" :
                            {
                                "type": "integer",
                                "description" : "Multicast address: The address that you use as destination in the synchronization messages."
                            },
                            "IPv4_interface" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "IP address of the interface that you are going to use to send the synchronization messages."
                            },
                            "Interface" :
                            {
                                "type": "string",
                                "description" : "The name of the interface that you are going to use to send the synchronization messages."
                            },
                            "SndSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol sender uses a buffer to enqueue the packets that are going to be transmitted."
                            },
                            "RcvSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol receiver uses a buffer to enqueue the packets that the socket is pending to handle."
                            },
                            "Checksum" :
                            {
                                "type": "boolean",
                                "description" : "Enable/Disable message checksumming. This is a good property to achieve fault-tolerance. In case of doubt, use it."
                            },
                            "mark_default" :
                            {
                                "type": "boolean",
                                "description" : "Defines this entry as default one. Only one default entry is supported."
                            },
                            "network" :
                            {
                                "type": "string",
                                "description" : "Use the designated network for communications. Automatically deduces IPv4 options and Interface options."
                            }
                        }
                    }
                },
                "UDP" :
                {
                    "type" : "array",
                    "description" : "This section indicates to conntrackd(8) to use UDP as transport mechanism between nodes of the firewall cluster.",
                    "items" :
                    {
                        "type" : "object",
                        "additionalProperties" : false,
                        "required" : ["Port"],
                        "properties" :
                        {
                            "IPv4_address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "UDP IPv4 address that this firewall uses to listen to events."
                            },
                            "IPv6_address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "UDP IPv6 address that this firewall uses to listen to events."
                            },
                            "IPv4_Destination_Address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "Destination IPv4 UDP address that receives events, ie.the other firewall's dedicated link address."
                            },
                            "IPv6_Destination_Address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "Destination IPv6 UDP address that receives events, ie.the other firewall's dedicated link address."
                            },
                            "Port" :
                            {
                                "type": "integer",
                                "description" : "UDP port used.",
                                "minimum" : 1,
                                "maximum" : 65535
                            },
                            "Interface" :
                            {
                                "type": "string",
                                "description" : "The name of the interface that you are going to use to send the synchronization messages."
                            },
                            "SndSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol sender uses a buffer to enqueue the packets that are going to be transmitted."
                            },
                            "RcvSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol receiver uses a buffer to enqueue the packets that the socket is pending to handle."
                            },
                            "Checksum" :
                            {
                                "type": "boolean",
                                "description" : "Enable/Disable message checksumming. This is a good property to achieve fault-tolerance. In case of doubt, use it."
                            },
                            "mark_default" :
                            {
                                "type": "boolean",
                                "description" : "Defines this entry as default one. Only one default entry is supported."
                            },
                            "network" :
                            {
                                "type": "string",
                                "description" : "Use the designated network for communications. Automatically deduces IPv4/IPv6 options and Interface options."
                            },
                            "dst_host" :
                            {
                                "type": "string",
                                "description" : "Connect to the specified host. Automatically deduces IPv4/IPv6 options and Interface options."
                            }
                        }
                    }
                },
                "TCP" :
                {
                    "type" : "array",
                    "description" : "You can also use Unicast TCP to propagate events. If you combine this transport with the NOTRACK mode, it becomes reliable.",
                    "items" :
                    {
                        "type" : "object",
                        "additionalProperties" : false,
                        "required" : ["Port"],
                        "properties" :
                        {
                            "IPv4_address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "UDP IPv4 address that this firewall uses to listen to events."
                            },
                            "IPv6_address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "UDP IPv6 address that this firewall uses to listen to events."
                            },
                            "IPv4_Destination_Address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "Destination IPv4 UDP address that receives events, ie.the other firewall's dedicated link address."
                            },
                            "IPv6_Destination_Address" :
                            {
                                "type": "string",
                                "format": "ip-address",
                                "description" : "Destination IPv6 UDP address that receives events, ie.the other firewall's dedicated link address."
                            },
                            "Port" :
                            {
                                "type": "integer",
                                "description" : "UDP port used.",
                                "minimum" : 1,
                                "maximum" : 65535
                            },
                            "Interface" :
                            {
                                "type": "string",
                                "description" : "The name of the interface that you are going to use to send the synchronization messages."
                            },
                            "SndSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol sender uses a buffer to enqueue the packets that are going to be transmitted."
                            },
                            "RcvSocketBuffer" :
                            {
                                "type": "integer",
                                "description" : "This transport protocol receiver uses a buffer to enqueue the packets that the socket is pending to handle."
                            },
                            "Checksum" :
                            {
                                "type": "boolean",
                                "description" : "Enable/Disable message checksumming. This is a good property to achieve fault-tolerance. In case of doubt, use it."
                            },
                            "mark_default" :
                            {
                                "type": "boolean",
                                "description" : "Defines this entry as default one. Only one default entry is supported."
                            },
                            "network" :
                            {
                                "type": "string",
                                "description" : "Use the designated network for communications. Automatically deduces IPv4/IPv6 options and Interface options."
                            },
                            "dst_host" :
                            {
                                "type": "string",
                                "description" : "Connect to the specified host. Automatically deduces IPv4/IPv6 options and Interface options."
                            }
                        }
                    }
                }
            }
        },
        "STATS":
        {
            "type" : "object",
            "additionalProperties" : false,
            "description" : "This top-level section indicates conntrackd(8) to work as a statistic collector for the nf_conntrack linux kernel subsystem.",
            "properties":
            {
                "LogFile":
                {
                    "type" : "string",
                    "description" : "If you enable this option, the daemon writes the information about destroyed connections to a logfile."
                },
                "NetlinkEventsReliable":
                {
                    "type" : "boolean",
                    "description" : "If you want reliable event reporting over Netlink, set on this option. If you set on this clause, it is a good idea to set off NetlinkOverrunResync."
                },
                "Syslog":
                {
                    "type" : "string",
                    "description" : "If you enable this option, the daemon writes the information about destroyed connections to a logfile.",
                    "enum" : ["kern","user","mail","daemon","auth","syslog","klpr","news","uucp","cron","authpriv","ftp","ntp","security","console","solaris-cron","local0","local1","local2","local3","local3","local4","local5","local6","local7"]
                }
            }
        },
        "UNIX":
        {
            "type" : "object",
            "additionalProperties" : false,
            "description" : "Unix socket configuration. This socket is used by conntrackd(8) to listen to external commands like `conntrackd -k' or `conntrackd -n'.",
            "properties":
            {
                "Path":
                {
                    "type" : "string",
                    "description" : "Absolute path to the Unix socket."
                }
            }
        },
        "SCHEDULER":
        {
            "type" : "object",
            "additionalProperties" : false,
            "description" : "Select a different scheduler for the daemon, you can select between RR and FIFO and the process priority.",
            "properties":
            {
                "Type":
                {
                    "type" : "string",
                    "description" : "Supported values are RR or FIFO.",
                    "enum" : ["RR","FIFO"]
                },
                "Priority":
                {
                    "type" : "integer",
                    "description" : "Value of the scheduler priority.Minimum is 0, maximum is 99.",
                    "minimum" : 0,
                    "maximum" : 99
                }
            }
        },
        "add_firewall_rules":
        {
            "type" : "boolean",
            "description" : "Controls koala behaviour of generating firewall rules for conntrackd sync traffic. Default: false."
        },
        "_fw_rule_in_name":
        {
            "type" : ["string", "null"],
            "description" : "If you don't know what it does, don't touch it."
        },
        "_fw_rule_out_name":
        {
            "type" : ["string", "null"],
            "description" : "If you don't know what it does, don't touch it."
        }
    }
}